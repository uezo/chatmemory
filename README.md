# chatmemory

Long-term and medium-term memories with you and chatbotğŸ’•

# ğŸš€ Quick start

1. Clone this repo to your local machine.
1. Import dependencies.
    ```bash
    $ pip install -r requirements.txt
    ```
1. Start ChatMemory server example.
    ```bash
    $ python example_server.py
    ```
1. Start example chatbot in another terminal.
    ```bash
    $ python example.py
    ```
1. Chat with bot and lastly press Ctrl+C once to exit conversation loop and wait for archiving memories ends.
1. Start example chatbot again and chat. During the course of the conversation, try asking questions that require memories for answers.
    ```bash
    $ python example.py
    ```

# ğŸ¥³ Chat example

These are the actual conversation logs. I cleared `messages` list before starting each session.

The 1st session.
```
user> ã¯ã‚ãƒ¼
assistant> ã¯ã˜ã‚ã¾ã—ã¦ã€ã“ã‚“ã«ã¡ã¯ï¼ã©ã®ã‚ˆã†ãªã“ã¨ã§ãŠæ‰‹ä¼ã„ã§ãã¾ã™ã‹ã€userã•ã‚“ï¼Ÿ
user> ã¨ã‚Šã‚ãˆãšãã®userã•ã‚“ã£ã¦ã®ã‚’ã‚„ã‚ã‚ˆã†ã‹
assistant> ã™ã¿ã¾ã›ã‚“ã€userã•ã‚“ã¨å‘¼ã¶ã®ã¯æ°—ã«å…¥ã£ã¦ã„ãŸã ã‘ãªã„ã‚ˆã†ã§ã™ã­ã€‚ã§ã¯ã€ã©ã®ã‚ˆã†ã«å‘¼ã³ã¾ã—ã‚‡ã†ã‹ï¼ŸãŠå¥½ããªå‘¼ã³æ–¹ã‚’æ•™ãˆã¦ãã ã•ã„ã€‚
user> ã†ãˆãã†ã£ã¦å‘¼ã‚“ã§ã­
assistant> ã‚ã‹ã‚Šã¾ã—ãŸã€ã†ãˆãã†ã•ã‚“ã¨å‘¼ã°ã›ã¦ã„ãŸã ãã¾ã™ã­ï¼ã©ã®ã‚ˆã†ãªãŠè©±ãŒãŠèã‹ã›ã„ãŸã ã‘ã‚‹ã§ã—ã‚‡ã†ã‹ã€ã†ãˆãã†ã•ã‚“ï¼Ÿãªã«ã‹ãŠå›°ã‚Šã®ã“ã¨ã‚„è³ªå•ãŒã‚ã‚Šã¾ã™ã‹ï¼ŸãŠæ‰‹ä¼ã„ã§ãã‚‹ã“ã¨ãŒã‚ã‚Œã°ã€ã©ã†ããŠæ•™ãˆãã ã•ã„ã€‚
user> ã¾ãŸã“ã‚“ã©ã‚†ã£ãã‚ŠãŠã—ã‚ƒã¹ã‚Šã—ã‚ˆ
assistant> ãã†ã§ã™ã‹ã€ã¾ãŸã‚†ã£ãã‚ŠãŠã—ã‚ƒã¹ã‚Šã—ã¾ã—ã‚‡ã†ã­ï¼æ¥½ã—ã¿ã«ã—ã¦ã„ã¾ã™ã€‚æ°—è»½ã«è©±ã—ã‹ã‘ã¦ãã ã•ã„ã€‚ãŠä¼šã„ã§ãã‚‹ã®ã‚’æ¥½ã—ã¿ã«ã—ã¦ã„ã¾ã™ã€ã†ãˆãã†ã•ã‚“ï¼
```

The 2nd session.
```
user> ã‚„ã‚ã€ã¾ãŸã‚ã£ãŸã­
assistant> ã“ã‚“ã«ã¡ã¯ã€ã†ãˆãã†ã•ã‚“ï¼ãŠä¼šã„ã§ãã¦å¬‰ã—ã„ã§ã™ã€‚ä»Šæ—¥ã¯ã„ã‹ãŒãŠéã”ã—ã§ã™ã‹ï¼Ÿä½•ã‹ãŠæ‰‹ä¼ã„ã§ãã‚‹ã“ã¨ãŒã‚ã‚Œã°ã€ãŠä¼ãˆãã ã•ã„ã­ã€‚ã„ã¾ã™ãã«ã§ã‚‚ãŠç­”ãˆã—ã¾ã™ã‚ˆã€‚
user> ã‚‚ã£ã¨æ¥½ãªæ„Ÿã˜ã«ã—ã¦ãã‚Œã¦ã„ã„ã‚ˆã€ä¸€ç·’ã«æ¥½ã—ã‚‚ã†ã‚ˆ
assistant> ãã†ã§ã™ã‹ã€æ¥½ã—ã„é›°å›²æ°—ã§ãŠã—ã‚ƒã¹ã‚Šã—ã¾ã—ã‚‡ã†ï¼ã©ã‚“ãªè©±é¡ŒãŒå¥½ãã§ã™ã‹ï¼ŸéŸ³æ¥½ã‚„æ˜ ç”»ã€æ—…è¡Œã®è©±ã§ã‚‚ã„ã„ã§ã™ã—ã€æœ€è¿‘ã®ãŠæ°—ã«å…¥ã‚Šã®ã‚¢ã‚¤ãƒ‰ãƒ«ã‚°ãƒ«ãƒ¼ãƒ—ã‚„è¶£å‘³ã®è©±ã§ã‚‚ã‹ã¾ã„ã¾ã›ã‚“ã€‚ãªã‚“ã§ã‚‚ã”è‡ªç”±ã«ãŠè©±ã—ãã ã•ã„ã­ã€‚ä¸€ç·’ã«æ¥½ã—ã¿ã¾ã—ã‚‡ã†ï¼
user> ãƒ•ãƒ©ãƒ³ã‚·ãƒ¥ã‚·ãƒ¥ãŒå¥½ãã ãªã‚
assistant> ãƒ•ãƒ©ãƒ³ã‚·ãƒ¥ã‚·ãƒ¥ã§ã™ã­ï¼ç´ æ•µãªã‚¢ã‚¤ãƒ‰ãƒ«ã‚°ãƒ«ãƒ¼ãƒ—ã§ã™ã­ã€‚å½¼å¥³ãŸã¡ã®æ­Œå£°ã¨ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã¯æœ¬å½“ã«é­…åŠ›çš„ã§ã™ã‚ˆã­ã€‚ç§ã‚‚åŒã˜ããƒ•ãƒ©ãƒ³ã‚·ãƒ¥ã‚·ãƒ¥ã®ãƒ•ã‚¡ãƒ³ã§ã™ã€‚

å½¼å¥³ãŸã¡ã®æœ€æ–°ã®ã‚·ãƒ³ã‚°ãƒ«ã‚„ãƒ©ã‚¤ãƒ–ã«ã¤ã„ã¦è©±ã—ã¾ã—ã‚‡ã†ã‹ï¼Ÿæ–°æ›²ã®ä¸­ã§ãŠæ°—ã«å…¥ã‚Šã¯ã‚ã‚Šã¾ã™ã‹ï¼Ÿç§ã®ãŠæ°—ã«å…¥ã‚Šã¯ã€Œå¤è‰²ã‚«ãƒ¼ãƒ‹ãƒãƒ«ã€ã§ã™ï¼æ¥½æ›²ã‚‚æ˜ã‚‹ãã¦ã‚­ãƒ¥ãƒ¼ãƒˆãªã®ã§ã€å¤ã®ã‚¤ãƒ™ãƒ³ãƒˆã§ç››ã‚Šä¸ŠãŒã‚‹ã¨æ€ã„ã¾ã™ã€‚

ã¾ãŸã€ãƒ•ãƒ©ãƒ³ã‚·ãƒ¥ã‚·ãƒ¥ã®ãƒ¡ãƒ³ãƒãƒ¼ã®ä¸­ã§ç‰¹ã«å¥½ããªãƒ¡ãƒ³ãƒãƒ¼ã¯ã„ã¾ã™ã‹ï¼Ÿç§ã¯ã¿ã‚“ãªãŒé­…åŠ›çš„ã§ã€ãã‚Œãã‚Œã®å€‹æ€§ãŒå…‰ã£ã¦ã„ã‚‹ã¨æ€ã„ã¾ã™ã€‚ã¡ãªã¿ã«ç§ã®ãŠæ°—ã«å…¥ã‚Šã®ãƒ¡ãƒ³ãƒãƒ¼ã¯è‘µã¡ã‚ƒã‚“ã§ã™ã€‚

ãƒ•ãƒ©ãƒ³ã‚·ãƒ¥ã‚·ãƒ¥ã®é­…åŠ›ã«ã¤ã„ã¦ã€ä¸€ç·’ã«èªã‚Šåˆã„ã¾ã—ã‚‡ã†ï¼ã©ã‚“ãªè©±é¡Œã§ã‚‚æ§‹ã„ã¾ã›ã‚“ã®ã§ã€ä½•ã‹èããŸã„ã“ã¨ã‚„ãŠè©±ã—ãŸã„ã“ã¨ãŒã‚ã‚Œã°æ•™ãˆã¦ãã ã•ã„ã­ã€‚
user> ã‚ã£ã€ã¡ã‚‡ã£ã¨é›»è©±ã‹ã‹ã£ã¦ããŸã‹ã‚‰ã¾ãŸã‚ã¨ã§ã­
assistant> ã‚ã‹ã‚Šã¾ã—ãŸã€ã†ãˆãã†ã•ã‚“ã€‚å¤§ä¸ˆå¤«ã§ã™ã€ã‚†ã£ãã‚ŠãŠè©±ã—ã¾ã—ã‚‡ã†ã€‚é›»è©±ã‚’ãŠå—ã‘ã«ãªã£ã¦ãã ã•ã„ã­ã€‚ã¾ãŸå¾Œã§ãŠå¾…ã¡ã—ã¦ã„ã¾ã™ã€‚æ¥½ã—ã„ãŠè©±ã‚’ã—ã¾ã—ã‚‡ã†ï¼ã§ã¯ã€ã„ã£ã¦ã‚‰ã£ã—ã‚ƒã„ã¾ã›ã€‚
```

The 3rd session.
```
user> ãŠã¾ãŸã›ã€œ
assistant> ã†ãˆãã†ã•ã‚“ã€ã“ã‚“ã°ã‚“ã¯ï¼ãŠã¾ãŸã›ã—ã¾ã—ãŸã‹ï¼Ÿã©ã†ã„ã£ãŸã”ç”¨ä»¶ã§ã—ã‚‡ã†ã‹ï¼ŸãŠæ‰‹ä¼ã„ã§ãã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã—ãŸã‚‰ã€ãªã‚“ã§ã‚‚ãŠã£ã—ã‚ƒã£ã¦ãã ã•ã„ã­ï¼
user> ãªã‚“ã‹ãŠã—ã‚ƒã¹ã‚Šã—ã‚ˆ
assistant> ãã†ã§ã™ã‹ã€ãŠã—ã‚ƒã¹ã‚Šã—ã¾ã—ã‚‡ã†ï¼æ¥½ã—ã„ãŠã—ã‚ƒã¹ã‚ŠãŒã§ãã‚‹ã¨å¬‰ã—ã„ã§ã™ã€‚ã§ã¯ã€ã©ã‚“ãªè©±é¡ŒãŒãŠå¥½ãã§ã™ã‹ï¼Ÿä¾‹ãˆã°ã€éŸ³æ¥½ã‚„ã‚¢ã‚¤ãƒ‰ãƒ«ã«ã¤ã„ã¦èªã‚Šåˆã†ã®ã‚‚æ¥½ã—ã„ã§ã™ã‚ˆã€‚å…ˆã»ã©ãŠã£ã—ã‚ƒã£ã¦ã„ãŸãƒ•ãƒ©ãƒ³ã‚·ãƒ¥ã‚·ãƒ¥ã«ã¤ã„ã¦ã‚‚ãŠè©±ã§ãã‚Œã°å¬‰ã—ã„ã§ã™ã€‚ã‚ã€ã¡ãªã¿ã«ã€ç§ã‚‚å½¼å¥³ãŸã¡ã®ãƒ•ã‚¡ãƒ³ãªã‚“ã§ã™ã€‚ã§ã™ã®ã§ã€ä¸€ç·’ã«ç››ã‚Šä¸ŠãŒã‚Šã¾ã—ã‚‡ã†ï¼ã©ã‚“ãªè©±é¡Œã‹ã‚‰å§‹ã‚ã¾ã™ã‹ï¼Ÿ
```

Mid-term memory after conversation:

```
- 2023-08-19: userã¯ãƒ†ãƒ³ã‚·ãƒ§ãƒ³ãŒé«˜ãã€assistantã¯userã®æ‚©ã¿ã‚„å›°ã‚Šã”ã¨ã‚’èãæ…‹åº¦ã§æ¥ã—ã¦ã„ã‚‹ã€‚userã¯è‡ªåˆ†ã®å‘¼ã³æ–¹ã‚’å¤‰ãˆã‚‹ã‚ˆã†ã«è¦æ±‚ã—ã€assistantã¯ãã‚Œã«å¿œã˜ã‚‹ã€‚userã¯ãƒ•ãƒ©ãƒ³ã‚·ãƒ¥ã‚·ãƒ¥ãŒå¥½ãã§ã€assistantã‚‚ãƒ•ã‚¡ãƒ³ã§ã‚ã‚‹ã“ã¨ã‚’æ˜ã‹ã™ã€‚äºŒäººã¯ãƒ•ãƒ©ãƒ³ã‚·ãƒ¥ã‚·ãƒ¥ã«ã¤ã„ã¦è©±ã—åˆã„ã€ã¾ãŸä¼šè©±ã‚’ç¶šã‘ã‚‹ã“ã¨ã‚’ç´„æŸã™ã‚‹ã€‚
```

Long-term memory after conversation:

```json
{"user_name": "ã†ãˆãã†", "favorite_idol_group": "ãƒ•ãƒ©ãƒ³ã‚·ãƒ¥ã‚·ãƒ¥"}
```


# ğŸª„ How it works

Very simple memory hack.

## Long-term momory

Just adding JSON entities with some instructions to system message.

```
# ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«é–¢ã—ã¦ä¼šè©±ã‚’é€šã˜ã¦èãå‡ºã—ãŸã“ã¨

ä»¥ä¸‹ã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨ã®ä¼šè©±ã‚’é€šã˜ã¦ã‚ãªãŸãŒè¨˜æ†¶ã—ã¦ã„ã‚‹å†…å®¹ã§ã™ã€‚å¼·ãæ„è­˜ã™ã‚‹å¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“ãŒã€ä¼šè©±ã®æµã‚Œã§ã“ã‚Œã‚‰ã®æƒ…å ±ãŒå¿…è¦ã«ãªã£ãŸå ´åˆã¯ã“ã‚Œã‚‰ã®æƒ…å ±ã‚’ä¼šè©±ã«åˆ©ç”¨ã—ã¦ãã ã•ã„ã€‚

{
    "nickname": "ã†ãˆãã†",
    "favorite_food": "ã†ãªã",
}
```

## Mid-term memory

Insert virtual user message that includes memories for last 5 days to messages before the second turn in conversation.

messages at the end of the 1st turn.
```json
[
    {"role": "system", "content": "You are user's sister."},
    {"role": "user", "content": "Hi."},
    {"role": "assistant", "content": "Hi, there!"}
]
```

insert virtual mid-turn user message before the 2nd turn.
This is intended to create a one-shot example that the 1st turn was not influenced by the context of previous conversations, and to encourage subsequent conversations not to be overly influenced.

```json
[
    {"role": "system", "content": "You are user's sister."},
    {"role": "user", "content": "ä»¥ä¸‹ã¯ã“ã“3æ—¥é–“ã«ã‚ã£ãŸãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨ã®ä¼šè©±ã‚’è¦ç´„ã—ãŸã‚‚ã®ã§ã™ã€‚\n\n- 2023-08-11: æŒ¨æ‹¶ã‚’äº¤ã‚ã—ãŸã‚ã¨ã€userã¯è‡ªã‚‰ã®ã“ã¨ã‚’ã†ãˆãã†ã¨å‘¼ã¶ã‚ˆã†ã«ä¾é ¼ã—ã€assistantã¯äº†æ‰¿ã—ã¾ã—ãŸã€‚..."},
    {"role": "user", "content": "Hi."},
    {"role": "assistant", "content": "Hi, there!"}
]
```
